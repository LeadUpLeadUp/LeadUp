<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold & Black Insurance CRM | Enterprise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        
        :root {
            --gold: #D4AF37;
            --gold-light: #F9E79F;
            --black-pearl: #0B0E11;
        }

        body { font-family: 'Assistant', sans-serif; background-color: #0f1115; color: #e5e7eb; }
        
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%); }
        .gold-text { color: var(--gold); }
        .card-dark { background: #1a1d23; border: 1px solid #2d3139; }
        .input-dark { background: #0b0e11; border: 1px solid #3f444e; color: white; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-black border-l border-gray-800 flex flex-col items-center py-8">
        <div class="mb-10 text-center">
            <h1 class="text-2xl font-bold gold-text tracking-widest">INSURE <span class="text-white">PRO</span></h1>
            <p class="text-xs text-gray-500">Premium Management</p>
        </div>
        
        <nav class="w-full px-4 space-y-2">
            <button onclick="switchTab('dashboard')" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-900 transition text-gold-light border-r-2 border-gold"><i data-lucide="layout-dashboard"></i> ×“××©×‘×•×¨×“</button>
            <button onclick="switchTab('leads')" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-900 transition text-gray-400"><i data-lucide="users"></i> ×œ×™×“×™×</button>
            <button onclick="switchTab('tasks')" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-900 transition text-gray-400"><i data-lucide="check-square"></i> ××©×™××•×ª</button>
            <button onclick="exportCSV()" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-900 transition text-gray-400 mt-20"><i data-lucide="download"></i> ×™×™×¦×•× × ×ª×•× ×™×</button>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-8">
        
        <header class="flex justify-between items-center mb-10">
            <div>
                <h2 id="tab-title" class="text-3xl font-bold">×“××©×‘×•×¨×“ KPI</h2>
                <p id="current-user" class="text-gray-500">×©×œ×•×, ×× ×”×œ (Admin)</p>
            </div>
            <div class="flex gap-4">
                <button onclick="openModal()" class="gold-gradient text-black font-bold px-6 py-2 rounded-full shadow-lg hover:scale-105 transition">+ ×œ×™×“ ×—×“×©</button>
            </div>
        </header>

        <section id="dashboard-view">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                <div class="card-dark p-6 rounded-xl">
                    <p class="text-gray-400 text-sm">×¡×”"×› ×œ×™×“×™×</p>
                    <h3 class="text-3xl font-bold mt-2" id="stat-total-leads">0</h3>
                    <span class="text-green-500 text-xs">â†‘ 12% ×”×—×•×“×©</span>
                </div>
                <div class="card-dark p-6 rounded-xl border-r-4 border-gold">
                    <p class="text-gray-400 text-sm">×œ×™×“×™× ×—××™×</p>
                    <h3 class="text-3xl font-bold mt-2 gold-text" id="stat-hot-leads">0</h3>
                </div>
                <div class="card-dark p-6 rounded-xl">
                    <p class="text-gray-400 text-sm">×™×—×¡ ×”××¨×”</p>
                    <h3 class="text-3xl font-bold mt-2">24%</h3>
                </div>
                <div class="card-dark p-6 rounded-xl">
                    <p class="text-gray-400 text-sm">××©×™××•×ª ×œ×”×™×•×</p>
                    <h3 class="text-3xl font-bold mt-2 text-red-500" id="stat-tasks">0</h3>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card-dark p-6 rounded-xl col-span-2">
                    <h4 class="mb-4 font-semibold">×‘×™×¦×•×¢×™ ××›×™×¨×•×ª ×—×•×“×©×™×™×</h4>
                    <canvas id="salesChart" height="100"></canvas>
                </div>
                <div class="card-dark p-6 rounded-xl">
                    <h4 class="mb-4 font-semibold">×œ×•×’ ×¤×¢×•×œ×•×ª ××—×¨×•×Ÿ (Timeline)</h4>
                    <ul id="timeline" class="space-y-4 text-sm text-gray-400">
                        </ul>
                </div>
            </div>
        </section>

        <section id="leads-view" class="hidden">
            <div class="card-dark p-4 rounded-xl mb-6 flex flex-wrap gap-4 items-center">
                <input type="text" id="searchLeads" oninput="renderLeads()" placeholder="×—×™×¤×•×© ×œ×¤×™ ×©× ××• ×˜×œ×¤×•×Ÿ..." class="input-dark px-4 py-2 rounded-lg flex-1">
                <select id="filterStatus" onchange="renderLeads()" class="input-dark px-4 py-2 rounded-lg">
                    <option value="all">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                    <option value="×—×">ğŸ”¥ ×—×</option>
                    <option value="××¢×§×‘">â³ ××¢×§×‘</option>
                    <option value="×¡×’×•×¨">âœ… ×¡×’×•×¨</option>
                </select>
                <select id="sortBy" onchange="renderLeads()" class="input-dark px-4 py-2 rounded-lg">
                    <option value="date">××™×•×Ÿ ×œ×¤×™ ×ª××¨×™×š</option>
                    <option value="score">××™×•×Ÿ ×œ×¤×™ Lead Score</option>
                </select>
            </div>
            
            <div class="card-dark rounded-xl overflow-hidden">
                <table class="w-full text-right">
                    <thead class="bg-black text-gold border-b border-gray-800">
                        <tr>
                            <th class="p-4">×©×</th>
                            <th class="p-4">Lead Score</th>
                            <th class="p-4">×¡×˜×˜×•×¡</th>
                            <th class="p-4">××©×™××” ×”×‘××”</th>
                            <th class="p-4">×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</th>
                        </tr>
                    </thead>
                    <tbody id="leads-table-body"></tbody>
                </table>
            </div>
        </section>
    </main>

    <div id="leadModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
        <div class="card-dark p-8 rounded-2xl w-full max-w-md border border-gold">
            <h3 class="text-xl font-bold mb-6 gold-text">×”×•×¡×¤×ª ×œ×™×“ ×—×“×©</h3>
            <div class="space-y-4 text-right">
                <div>
                    <label class="block text-sm mb-1">×©× ××œ×</label>
                    <input type="text" id="form-name" class="input-dark w-full p-2 rounded">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm mb-1">×˜×œ×¤×•×Ÿ</label>
                        <input type="text" id="form-phone" class="input-dark w-full p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm mb-1">×¡×˜×˜×•×¡</label>
                        <select id="form-status" class="input-dark w-full p-2 rounded">
                            <option value="×—×">×—×</option>
                            <option value="××¢×§×‘">××¢×§×‘</option>
                            <option value="×™×©×Ÿ">×™×©×Ÿ</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-4 mt-6">
                    <button onclick="saveLead()" class="gold-gradient text-black flex-1 py-2 rounded font-bold">×©××•×¨</button>
                    <button onclick="closeModal()" class="bg-gray-700 text-white flex-1 py-2 rounded">×‘×™×˜×•×œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Core Data & Initialization ---
        let leads = JSON.parse(localStorage.getItem('crm_leads')) || [];
        let logs = JSON.parse(localStorage.getItem('crm_logs')) || [];

        function init() {
            lucide.createIcons();
            renderStats();
            renderTimeline();
            initChart();
            renderLeads();
        }

        // --- Tabs Logic ---
        function switchTab(tab) {
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('leads-view').classList.add('hidden');
            document.getElementById(tab + '-view').classList.remove('hidden');
            document.getElementById('tab-title').innerText = tab === 'dashboard' ? '×“××©×‘×•×¨×“ KPI' : '× ×™×”×•×œ ×œ×™×“×™×';
        }

        // --- Lead Management ---
        function openModal() { document.getElementById('leadModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('leadModal').classList.add('hidden'); }

        function saveLead() {
            const name = document.getElementById('form-name').value;
            const phone = document.getElementById('form-phone').value;
            const status = document.getElementById('form-status').value;

            const newLead = {
                id: Date.now(),
                name,
                phone,
                status,
                score: Math.floor(Math.random() * 50) + 50, // Initial Lead Score
                createdAt: new Date(),
                lastContact: new Date(),
                interactions: 1
            };

            leads.push(newLead);
            addLog(`×œ×™×“ ×—×“×© × ×•×¡×£: ${name}`, 'Admin');
            updateStorage();
            closeModal();
            renderLeads();
            renderStats();
        }

        function renderLeads() {
            const tbody = document.getElementById('leads-table-body');
            const search = document.getElementById('searchLeads').value.toLowerCase();
            const filter = document.getElementById('filterStatus').value;

            tbody.innerHTML = '';

            const filtered = leads.filter(l => 
                (l.name.toLowerCase().includes(search) || l.phone.includes(search)) &&
                (filter === 'all' || l.status === filter)
            );

            filtered.forEach(lead => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-800 hover:bg-gray-900 transition";
                tr.innerHTML = `
                    <td class="p-4">
                        <div class="font-bold">${lead.name}</div>
                        <div class="text-xs text-gray-500">${lead.phone}</div>
                    </td>
                    <td class="p-4">
                        <div class="w-16 bg-gray-700 h-2 rounded-full">
                            <div class="bg-gold h-2 rounded-full" style="width: ${lead.score}%"></div>
                        </div>
                        <span class="text-xs">${lead.score}/100</span>
                    </td>
                    <td class="p-4"><span class="px-2 py-1 rounded text-xs ${lead.status === '×—×' ? 'bg-red-900 text-red-200' : 'bg-blue-900 text-blue-200'}">${lead.status}</span></td>
                    <td class="p-4 text-xs">×‘×¢×•×“ 2 ×™××™×</td>
                    <td class="p-4">
                        <div class="flex gap-2">
                            <a href="https://wa.me/${lead.phone}" class="p-1 hover:text-green-500"><i data-lucide="message-circle" class="w-4"></i></a>
                            <button onclick="deleteLead(${lead.id})" class="p-1 hover:text-red-500"><i data-lucide="trash-2" class="w-4"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            lucide.createIcons();
        }

        function deleteLead(id) {
            leads = leads.filter(l => l.id !== id);
            addLog("×œ×™×“ ×”×•×¡×¨ ××”××¢×¨×›×ª", "Admin");
            updateStorage();
            renderLeads();
            renderStats();
        }

        // --- Logs & Stats ---
        function addLog(action, user) {
            logs.unshift({ action, user, time: new Date().toLocaleTimeString('he-IL') });
            if (logs.length > 5) logs.pop();
            updateStorage();
            renderTimeline();
        }

        function renderTimeline() {
            const list = document.getElementById('timeline');
            list.innerHTML = logs.map(log => `
                <li class="border-r border-gold pr-4">
                    <p class="text-white">${log.action}</p>
                    <small>${log.time} | ×¢×œ ×™×“×™ ${log.user}</small>
                </li>
            `).join('');
        }

        function renderStats() {
            document.getElementById('stat-total-leads').innerText = leads.length;
            document.getElementById('stat-hot-leads').innerText = leads.filter(l => l.status === '×—×').length;
            document.getElementById('stat-tasks').innerText = Math.floor(leads.length / 2);
        }

        function updateStorage() {
            localStorage.setItem('crm_leads', JSON.stringify(leads));
            localStorage.setItem('crm_logs', JSON.stringify(logs));
        }

        // --- Chart ---
        function initChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['×™× ×•××¨', '×¤×‘×¨×•××¨', '××¨×¥', '××¤×¨×™×œ'],
                    datasets: [{
                        label: '×¡×’×™×¨×•×ª (â‚ª)',
                        data: [12000, 19000, 15000, 25000],
                        borderColor: '#D4AF37',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(212, 175, 55, 0.1)'
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        function exportCSV() {
            let csv = "Name,Phone,Status,Score\n";
            leads.forEach(l => csv += `${l.name},${l.phone},${l.status},${l.score}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'leads_export.csv');
            a.click();
        }

        init();
    </script>
</body>
</html>
