<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LEADUP â€¢ ××¢×¨×›×ª × ×™×”×•×œ ×œ×™×“×™×</title>
  <meta name="theme-color" content="#0b0b0f"/>
  <style>
    :root{
      --bg:#07070a;
      --panel:#0c0c12;
      --panel2:#10101a;
      --line:rgba(255,255,255,.10);
      --text:#ffffff;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.55);
      --gold:#d6b25e;
      --gold2:#f2d27c;
      --ok:#2ee59d;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --shadow2:0 12px 30px rgba(0,0,0,.40);
      --r:18px;
      --r2:22px;
      --focus: 0 0 0 3px rgba(214,178,94,.22);
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial, "Noto Sans Hebrew", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 80% 10%, rgba(214,178,94,.10), transparent 55%),
        radial-gradient(900px 600px at 10% 80%, rgba(242,210,124,.06), transparent 60%),
        linear-gradient(180deg, #06060a, #050509);
      color:var(--text);
      font-family:var(--font);
      overflow:hidden;
    }
    a{color:inherit}
    .app{
      display:grid;
      grid-template-columns: 290px 1fr;
      height:100vh;
    }
    /* Sidebar */
    .side{
      border-left:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
      padding:18px 16px;
      overflow:auto;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 10px 16px 10px;
      border-bottom:1px solid var(--line);
      margin-bottom:14px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(circle at 30% 20%, rgba(242,210,124,.45), transparent 55%),
        linear-gradient(145deg, rgba(214,178,94,.50), rgba(214,178,94,.08));
      box-shadow:0 12px 30px rgba(214,178,94,.12);
      border:1px solid rgba(214,178,94,.25);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute; inset:10px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.18);
    }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.6px;
    }
    .brand .sub{
      margin-top:2px;
      color:var(--muted2);
      font-size:12px;
    }
    .nav{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:10px;
    }
    .nav button{
      width:100%;
      text-align:right;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.08);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      transition:.18s ease;
    }
    .nav button:hover{transform:translateY(-1px);border-color:rgba(214,178,94,.25)}
    .nav button.active{
      background:linear-gradient(180deg, rgba(214,178,94,.22), rgba(255,255,255,.04));
      border-color:rgba(214,178,94,.35);
      box-shadow:0 14px 32px rgba(214,178,94,.08);
    }
    .nav .k{
      display:flex;align-items:center;gap:10px;
      font-weight:650;
    }
    .pill{
      font-size:12px;
      color:rgba(255,255,255,.85);
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25);
    }
    .pill.gold{border-color:rgba(214,178,94,.35); color:rgba(242,210,124,.95)}
    .sideFooter{
      margin-top:16px;
      padding-top:14px;
      border-top:1px solid var(--line);
      color:var(--muted2);
      font-size:12px;
      line-height:1.5;
    }
    .sideFooter .hint{
      margin-top:8px;
      padding:10px 12px;
      border:1px solid rgba(214,178,94,.18);
      border-radius:14px;
      background:rgba(214,178,94,.06);
    }

    /* Main */
    .main{
      display:flex;
      flex-direction:column;
      height:100vh;
      overflow:hidden;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background:rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }
    .topbar .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:260px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(214,178,94,.30);
      background:rgba(214,178,94,.10);
      color:rgba(242,210,124,.95);
      font-size:12px;
      white-space:nowrap;
    }
    .badge .dot{width:8px;height:8px;border-radius:50%;background:var(--gold2);box-shadow:0 0 0 4px rgba(242,210,124,.18)}
    .topbar .title{
      display:flex; flex-direction:column;
    }
    .topbar .title b{font-size:16px}
    .topbar .title span{color:var(--muted2);font-size:12px;margin-top:2px}
    .topbar .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition:.18s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:650;
    }
    .btn:hover{transform:translateY(-1px); border-color:rgba(214,178,94,.25)}
    .btn:focus{outline:none; box-shadow:var(--focus)}
    .btn.gold{
      background:linear-gradient(180deg, rgba(214,178,94,.26), rgba(255,255,255,.05));
      border-color:rgba(214,178,94,.35);
      color:rgba(242,210,124,.98);
    }
    .btn.danger{
      border-color:rgba(255,107,107,.28);
      background:rgba(255,107,107,.08);
    }
    .search{
      position:relative;
      min-width:320px;
      max-width:520px;
      width:38vw;
    }
    .search input{
      width:100%;
      padding:12px 40px 12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.30);
      color:var(--text);
      outline:none;
      transition:.18s ease;
    }
    .search input:focus{box-shadow:var(--focus); border-color:rgba(214,178,94,.25)}
    .search .icon{
      position:absolute;
      left:12px;
      top:50%;
      transform:translateY(-50%);
      color:rgba(255,255,255,.55);
      font-size:14px;
      pointer-events:none;
    }
    .content{
      padding:16px 18px 22px;
      overflow:auto;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 1060px){
      .app{grid-template-columns: 1fr}
      .side{display:none}
      .grid{grid-template-columns: 1fr}
      body{overflow:auto}
      .main{height:auto}
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--r2);
      box-shadow:var(--shadow2);
      overflow:hidden;
    }
    .card .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 14px;
      border-bottom:1px solid rgba(255,255,255,.09);
    }
    .card .head h2{
      margin:0;
      font-size:14px;
      letter-spacing:.3px;
    }
    .card .body{padding:12px 14px 14px}
    .stats{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 760px){ .stats{grid-template-columns: repeat(2, 1fr)} }
    .stat{
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      position:relative;
      overflow:hidden;
    }
    .stat:before{
      content:"";
      position:absolute; inset:-80px -60px auto auto;
      width:160px;height:160px;border-radius:50%;
      background:rgba(214,178,94,.10);
      filter:blur(2px);
    }
    .stat .k{color:var(--muted2); font-size:12px}
    .stat .v{margin-top:6px; font-size:20px; font-weight:800}
    .stat .mini{margin-top:3px; font-size:12px; color:rgba(242,210,124,.86)}
    .tableWrap{overflow:auto}
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      font-size:13px;
      min-width:920px;
    }
    thead th{
      text-align:right;
      padding:12px 10px;
      color:rgba(255,255,255,.72);
      font-weight:700;
      border-bottom:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      position:sticky;
      top:0;
      z-index:2;
      backdrop-filter: blur(8px);
    }
    tbody td{
      padding:12px 10px;
      border-bottom:1px solid rgba(255,255,255,.07);
      vertical-align:middle;
      color:rgba(255,255,255,.92);
    }
    tbody tr:hover td{background:rgba(214,178,94,.05)}
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      font-size:12px;
      white-space:nowrap;
    }
    .tag.hot{border-color:rgba(255,204,102,.35); background:rgba(255,204,102,.08); color:rgba(255,204,102,.95)}
    .tag.ok{border-color:rgba(46,229,157,.30); background:rgba(46,229,157,.08); color:rgba(46,229,157,.95)}
    .tag.cold{border-color:rgba(255,255,255,.14); background:rgba(255,255,255,.03); color:rgba(255,255,255,.78)}
    .score{
      display:flex; align-items:center; gap:10px;
    }
    .bar{
      width:120px; height:10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%;
      background:linear-gradient(90deg, rgba(214,178,94,.25), rgba(242,210,124,.65));
      width:50%;
    }
    .actions{
      display:flex; gap:8px; flex-wrap:wrap;
      justify-content:flex-start;
    }
    .iconBtn{
      width:34px;height:34px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;
      transition:.16s ease;
    }
    .iconBtn:hover{transform:translateY(-1px);border-color:rgba(214,178,94,.25)}
    .iconBtn.gold{border-color:rgba(214,178,94,.30); background:rgba(214,178,94,.10)}
    .muted{color:var(--muted2)}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 760px){ .row{grid-template-columns:1fr} table{min-width:800px} }
    label{display:block; font-size:12px; color:rgba(255,255,255,.70); margin-bottom:6px}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.30);
      color:var(--text);
      outline:none;
      transition:.18s ease;
      font-family:inherit;
    }
    textarea{min-height:92px; resize:vertical}
    input:focus, select:focus, textarea:focus{box-shadow:var(--focus); border-color:rgba(214,178,94,.25)}
    .help{
      margin-top:8px;
      color:rgba(255,255,255,.62);
      font-size:12px;
      line-height:1.4;
    }

    /* Modal */
    .modalBack{
      position:fixed; inset:0;
      background:rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(980px, 100%);
      max-height:min(86vh, 900px);
      overflow:auto;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 600px at 85% 0%, rgba(214,178,94,.14), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      position:relative;
    }
    .modalHeader{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      position:sticky; top:0;
      backdrop-filter: blur(10px);
      background:rgba(0,0,0,.18);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      z-index:2;
    }
    .modalHeader b{font-size:14px}
    .modalBody{padding:14px 16px 16px}
    .closeX{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      cursor:pointer;
    }
    .toast{
      position:fixed;
      left:18px;
      bottom:18px;
      background:rgba(0,0,0,.65);
      border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:14px;
      box-shadow:var(--shadow2);
      display:none;
      z-index:60;
      max-width:min(520px, calc(100vw - 36px));
    }
    .split{
      display:grid;
      grid-template-columns: 1fr 340px;
      gap:12px;
      align-items:start;
    }
    @media (max-width: 900px){ .split{grid-template-columns:1fr} }
    .miniCard{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      border-radius:18px;
      padding:12px;
    }
    .miniCard h3{margin:0 0 10px 0; font-size:13px}
    .timeline{
      display:flex; flex-direction:column; gap:10px;
      max-height:350px; overflow:auto; padding-left:4px;
    }
    .event{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      border-radius:16px;
      padding:10px 10px;
    }
    .event .t{font-size:12px; color:rgba(255,255,255,.75)}
    .event .d{margin-top:4px; font-size:13px}
    .kbd{
      font-size:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);
      border-bottom-color:rgba(255,255,255,.24);
      padding:2px 8px;
      border-radius:10px;
      color:rgba(255,255,255,.85);
    }
    .small{font-size:12px}
    .sep{height:1px;background:rgba(255,255,255,.10); margin:12px 0}
  </style>
</head>

<body>
<div class="app">
  <aside class="side">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>LEADUP</h1>
        <div class="sub">CRM ×™×•×§×¨×ª×™ ×œ×œ×™×“×™× â€¢ ×¡×•×›× ×•×ª ×‘×™×˜×•×—</div>
      </div>
    </div>

    <div class="nav" id="nav">
      <button class="active" data-view="leads">
        <span class="k">ğŸ“Œ ×œ×™×“×™×</span>
        <span class="pill gold" id="navCount">0</span>
      </button>
      <button data-view="tasks">
        <span class="k">â° ××©×™××•×ª</span>
        <span class="pill" id="navTasks">0</span>
      </button>
      <button data-view="timeline">
        <span class="k">ğŸ§¾ ×”×™×¡×˜×•×¨×™×”</span>
        <span class="pill" id="navEvents">0</span>
      </button>
      <button data-view="settings">
        <span class="k">âš™ï¸ ×”×’×“×¨×•×ª</span>
        <span class="pill">Local</span>
      </button>
    </div>

    <div class="sideFooter">
      <div><b>×˜×™×¤:</b> ×›×œ ×¤×¢×•×œ×” × ×¤×ª×—×ª ×‘×ª×•×š ×—×œ×•×Ÿ ×‘××¢×¨×›×ª (××•×“××œ) â€” ×œ× × ×¤×ª×— ×—×œ×•×Ÿ ×—×™×¦×•× ×™.</div>
      <div class="hint">
        ×‘×§×¨×•×‘ × ×—×‘×¨ ×œ-Google Sheets ×“×¨×š Apps Script (×¨×§ ×ª×ª×Ÿ ×œ×™ ××ª ×›×ª×•×‘×ª ×”-URL ×•××–×”×” ×”×¤×¨×™×¡×”).
      </div>
    </div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="left">
        <span class="badge"><span class="dot"></span> ××¦×‘ ××¢×¨×›×ª: ×¤×¢×™×œ</span>
        <div class="title">
          <b id="viewTitle">×œ×™×“×™×</b>
          <span id="viewSub">× ×™×”×•×œ ×œ×™×“×™×, ×¡×˜×˜×•×¡×™×, ×¤×¢×•×œ×•×ª ×•××¢×§×‘</span>
        </div>
      </div>

      <div class="search">
        <span class="icon">âŒ•</span>
        <input id="q" placeholder="×—×™×¤×•×© ×œ×¤×™ ×©×/×˜×œ×¤×•×Ÿ/××™××™×™×œ/×”×¢×¨×”â€¦" autocomplete="off"/>
      </div>

      <div class="right">
        <button class="btn gold" id="btnAddLead">â• ×œ×™×“ ×—×“×©</button>
        <button class="btn" id="btnQuickTask">â±ï¸ ××©×™××” ××”×™×¨×”</button>
        <button class="btn" id="btnExport">â¬‡ï¸ ×™×™×¦×•×</button>
        <button class="btn" id="btnImport">â¬†ï¸ ×™×™×‘×•×</button>
      </div>
    </div>

    <div class="content">
      <div class="card" style="margin-bottom:14px">
        <div class="head">
          <h2>×“×©×‘×•×¨×“</h2>
          <div class="muted small">×§×™×¦×•×¨×™ ××§×œ×“×ª: <span class="kbd">N</span> ×œ×™×“ ×—×“×© â€¢ <span class="kbd">/</span> ×—×™×¤×•×©</div>
        </div>
        <div class="body">
          <div class="stats">
            <div class="stat">
              <div class="k">×¡×”×´×› ×œ×™×“×™×</div>
              <div class="v" id="stTotal">0</div>
              <div class="mini">×‘×××’×¨</div>
            </div>
            <div class="stat">
              <div class="k">×—××™×</div>
              <div class="v" id="stHot">0</div>
              <div class="mini">Lead Score ×’×‘×•×”</div>
            </div>
            <div class="stat">
              <div class="k">××¢×§×‘ ×”×™×•×</div>
              <div class="v" id="stToday">0</div>
              <div class="mini">Next Follow-up</div>
            </div>
            <div class="stat">
              <div class="k">××©×™××•×ª ×¤×ª×•×—×•×ª</div>
              <div class="v" id="stTasks">0</div>
              <div class="mini">×ª×–×›×•×¨×•×ª</div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <section class="card" id="viewLeads">
          <div class="head">
            <h2>×¨×©×™××ª ×œ×™×“×™×</h2>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <select id="fStatus" title="×¤×™×œ×˜×¨ ×¡×˜×˜×•×¡" style="width:170px">
                <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                <option>×—×“×©</option>
                <option>× ×•×¦×¨ ×§×©×¨</option>
                <option>××ª×¢× ×™×™×Ÿ</option>
                <option>×”×¦×¢×ª ××—×™×¨</option>
                <option>× ×¡×’×¨</option>
                <option>×œ× ×¨×œ×•×•× ×˜×™</option>
              </select>
              <select id="fSource" title="×¤×™×œ×˜×¨ ××§×•×¨" style="width:170px">
                <option value="">×›×œ ×”××§×•×¨×•×ª</option>
                <option>×¤×™×™×¡×‘×•×§</option>
                <option>×’×•×’×œ</option>
                <option>×”×¤× ×™×”</option>
                <option>×˜×œ×¤×•×Ÿ</option>
                <option>××ª×¨</option>
                <option>××—×¨</option>
              </select>
              <select id="sortBy" title="××™×•×Ÿ" style="width:170px">
                <option value="hot">××™×•×Ÿ: ×”×›×™ ×—×</option>
                <option value="next">××™×•×Ÿ: ×ª××¨×™×š ××¢×§×‘ ×”×‘×</option>
                <option value="newest">××™×•×Ÿ: ×”×›×™ ×—×“×©</option>
                <option value="oldest">××™×•×Ÿ: ×”×›×™ ×™×©×Ÿ</option>
              </select>
            </div>
          </div>
          <div class="body">
            <div class="tableWrap">
              <table>
                <thead>
                  <tr>
                    <th>×©×</th>
                    <th>×˜×œ×¤×•×Ÿ</th>
                    <th>×¡×˜×˜×•×¡</th>
                    <th>××§×•×¨</th>
                    <th>×—×•× (Score)</th>
                    <th>××¢×§×‘ ×”×‘×</th>
                    <th>×¤×¢×•×œ×•×ª</th>
                  </tr>
                </thead>
                <tbody id="leadsTbody"></tbody>
              </table>
            </div>
            <div class="help" id="emptyLeads" style="display:none">
              ××™×Ÿ ×¢×“×™×™×Ÿ ×œ×™×“×™×. ×œ×—×¥ ×¢×œ <b>â€œ×œ×™×“ ×—×“×©â€</b> ×›×“×™ ×œ×”×ª×—×™×œ.
            </div>
          </div>
        </section>

        <aside class="card" id="viewRight">
          <div class="head">
            <h2>××¨×›×– ×©×œ×™×˜×”</h2>
            <div class="pill gold">LEADUP</div>
          </div>
          <div class="body">
            <div class="miniCard" style="margin-bottom:10px">
              <h3>××” ×™×© ×‘××¢×¨×›×ª</h3>
              <div class="small muted">
                â€¢ ×œ×™×“×™× + ×¡×˜×˜×•×¡×™× + ×”×¢×¨×•×ª<br/>
                â€¢ ××©×™××•×ª ×•×ª×–×›×•×¨×•×ª ×œ×›×œ ×œ×™×“<br/>
                â€¢ ×”×™×¡×˜×•×¨×™×™×ª ×¤×¢×™×œ×•×ª (Timeline)<br/>
                â€¢ ×—×™×¤×•×©/×¤×™×œ×˜×¨×™×/××™×•×Ÿ<br/>
                â€¢ Lead Score (1â€“100)<br/>
                â€¢ ×•×•××˜×¡××¤ / ×”×ª×§×©×¨×•×ª / ××™×™×œ (×‘××•×“××œ)
              </div>
            </div>

            <div class="miniCard">
              <h3>×¤×¢×•×œ×” ××”×™×¨×”</h3>
              <button class="btn gold" style="width:100%" id="btnOpenInsights">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</button>
              <div class="sep"></div>
              <button class="btn" style="width:100%" id="btnSeed">âœ¨ ×¦×•×¨ ×“×•×’×××•×ª ×œ×™×“×™×</button>
              <div class="help">×”×›×œ × ×©××¨ ××§×•××™×ª ×‘×“×¤×“×¤×Ÿ (LocalStorage) ×¢×“ ×©× ×—×‘×¨ ×œ-Google Sheets.</div>
            </div>
          </div>
        </aside>

        <!-- Tasks view -->
        <section class="card" id="viewTasks" style="display:none">
          <div class="head">
            <h2>××©×™××•×ª</h2>
            <div class="muted small">×ª×–×›×•×¨×•×ª + ×¢×“×™×¤×•×ª + ×©×™×™×›×•×ª ×œ×œ×™×“</div>
          </div>
          <div class="body">
            <div class="tableWrap">
              <table style="min-width:860px">
                <thead>
                  <tr>
                    <th>××ª×™</th>
                    <th>×¢×“×™×¤×•×ª</th>
                    <th>×œ×™×“</th>
                    <th>×ª×™××•×¨</th>
                    <th>×¡×˜×˜×•×¡</th>
                    <th>×¤×¢×•×œ×•×ª</th>
                  </tr>
                </thead>
                <tbody id="tasksTbody"></tbody>
              </table>
            </div>
            <div class="help" id="emptyTasks" style="display:none">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª.</div>
          </div>
        </section>

        <!-- Timeline view -->
        <section class="card" id="viewTimeline" style="display:none">
          <div class="head">
            <h2>×”×™×¡×˜×•×¨×™×™×ª ×¤×¢×™×œ×•×ª</h2>
            <div class="muted small">×›×œ ×©×™× ×•×™ × ×©××¨: ××™/××ª×™/××” ×”×©×ª× ×”</div>
          </div>
          <div class="body">
            <div class="timeline" id="timelineList"></div>
            <div class="help" id="emptyTimeline" style="display:none">××™×Ÿ ×¢×“×™×™×Ÿ ××™×¨×•×¢×™×.</div>
          </div>
        </section>

        <!-- Settings view -->
        <section class="card" id="viewSettings" style="display:none">
          <div class="head">
            <h2>×”×’×“×¨×•×ª</h2>
            <div class="muted small">×—×™×‘×•×¨ Google Sheets ×™×™×›× ×¡ ×›××Ÿ</div>
          </div>
          <div class="body">
            <div class="miniCard">
              <h3>×©××™×¨×”/××™×¤×•×¡</h3>
              <div class="row">
                <button class="btn" id="btnBackup" type="button">ğŸ’¾ ×™×¦× ×’×™×‘×•×™ JSON</button>
                <button class="btn danger" id="btnReset" type="button">ğŸ§¨ ××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™×</button>
              </div>
              <div class="sep"></div>
              <h3>Google Sheets (×‘×§×¨×•×‘)</h3>
              <div class="small muted">
                ×›×“×™ ×œ×—×‘×¨ ×œ×¡× ×›×¨×•×Ÿ, × ×¦×˜×¨×š:
                <ul>
                  <li>URL ×©×œ ×”-Web App</li>
                  <li>ID ×©×œ ×”×¤×¨×™×¡×” (Deployment)</li>
                  <li>×©× ×’×™×œ×™×•×Ÿ / ×˜××‘</li>
                </ul>
                ×‘×¨×’×¢ ×©×ª×©×œ×— ×œ×™ â€” ××•×¡×™×£ ×œ×š ×‘×§×•×“ ××ª ×”×—×™×‘×•×¨, ×¢× Fetch, ×•×”×›×œ ×™×¢×‘×•×“ ×“×¨×š ×”×©×™×˜.
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </main>
</div>

<!-- Modal -->
<div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modalHeader">
      <b id="modalTitle">×›×•×ª×¨×ª</b>
      <button class="closeX" id="modalClose" title="×¡×’×•×¨">âœ•</button>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =======================
   LEADUP â€¢ Local CRM
   ======================= */

const LS_KEY = "leadup_v1";
const nowISO = () => new Date().toISOString();
const fmtDT = (iso) => {
  if(!iso) return "â€”";
  const d = new Date(iso);
  if(Number.isNaN(d.getTime())) return "â€”";
  return d.toLocaleString("he-IL", { dateStyle:"medium", timeStyle:"short" });
};
const todayKey = () => new Date().toLocaleDateString("sv-SE"); // YYYY-MM-DD
const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

const appState = loadState();

function defaultState(){
  return {
    user: { name: "×× ×”×œ", role: "Admin" },
    leads: [],
    tasks: [],
    events: []
  };
}
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return defaultState();
    const parsed = JSON.parse(raw);
    return { ...defaultState(), ...parsed };
  }catch(e){
    return defaultState();
  }
}
function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify(appState));
  renderAll();
}

function uid(prefix="id"){
  return prefix + "_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
}

/* ===== Activity Timeline ===== */
function addEvent(type, text, meta={}){
  appState.events.unshift({
    id: uid("ev"),
    at: nowISO(),
    who: appState.user?.name || "××©×ª××©",
    type, text, meta
  });
  // keep events reasonable
  appState.events = appState.events.slice(0, 500);
}

/* ===== Lead Score =====
   1â€“100 based on:
   - contactCount (talks)
   - days since lastContact / createdAt
   - source warmth
   - status stage
*/
function sourceWeight(source){
  const s = (source||"").toLowerCase();
  if(["×”×¤× ×™×”","ref","referral"].some(x=>s.includes(x))) return 22;
  if(s.includes("×˜×œ×¤×•×Ÿ")) return 18;
  if(s.includes("×’×•×’×œ")) return 16;
  if(s.includes("××ª×¨")) return 14;
  if(s.includes("×¤×™×™×¡×‘×•×§")) return 12;
  return 10;
}
function statusWeight(status){
  switch(status){
    case "×—×“×©": return 10;
    case "× ×•×¦×¨ ×§×©×¨": return 18;
    case "××ª×¢× ×™×™×Ÿ": return 26;
    case "×”×¦×¢×ª ××—×™×¨": return 34;
    case "× ×¡×’×¨": return 40;
    case "×œ× ×¨×œ×•×•× ×˜×™": return 2;
    default: return 10;
  }
}
function computeScore(lead){
  const talks = clamp(Number(lead.contactCount||0), 0, 20);
  const talkScore = talks * 2.2; // max 44

  const base = 18;
  const src = sourceWeight(lead.source);
  const st = statusWeight(lead.status);

  const refDate = lead.lastContactAt || lead.createdAt || nowISO();
  const days = Math.floor((Date.now() - new Date(refDate).getTime()) / (1000*60*60*24));
  const recencyPenalty = clamp(days * 1.6, 0, 40); // older => lower
  let score = base + src + st + talkScore - recencyPenalty;

  if(lead.status === "× ×¡×’×¨") score += 10;
  if(lead.status === "×œ× ×¨×œ×•×•× ×˜×™") score = Math.min(score, 15);

  score = clamp(Math.round(score), 1, 100);
  return score;
}
function heatTag(score){
  if(score >= 75) return { cls:"hot", label:"×—×" };
  if(score >= 45) return { cls:"ok", label:"×‘×™× ×•× ×™" };
  return { cls:"cold", label:"×§×¨" };
}

/* ===== Views ===== */
const el = (id)=>document.getElementById(id);
const nav = el("nav");
nav.addEventListener("click", (e)=>{
  const btn = e.target.closest("button[data-view]");
  if(!btn) return;
  setView(btn.dataset.view);
});
function setView(view){
  document.querySelectorAll(".nav button").forEach(b=>b.classList.toggle("active", b.dataset.view===view));
  // hide/show cards
  el("viewLeads").style.display = (view==="leads") ? "" : "none";
  el("viewRight").style.display = (view==="leads") ? "" : "none";
  el("viewTasks").style.display = (view==="tasks") ? "" : "none";
  el("viewTimeline").style.display = (view==="timeline") ? "" : "none";
  el("viewSettings").style.display = (view==="settings") ? "" : "none";

  const titles = {
    leads: ["×œ×™×“×™×", "× ×™×”×•×œ ×œ×™×“×™×, ×¡×˜×˜×•×¡×™×, ×¤×¢×•×œ×•×ª ×•××¢×§×‘"],
    tasks: ["××©×™××•×ª", "×ª×–×›×•×¨×•×ª ×¢× ×ª××¨×™×š/×©×¢×” + ×¢×“×™×¤×•×ª + ×©×™×•×š ×œ×œ×™×“"],
    timeline: ["×”×™×¡×˜×•×¨×™×”", "Timeline ×©×œ ×›×œ ×¤×¢×•×œ×” ×•×©×™× ×•×™ ×‘××¢×¨×›×ª"],
    settings: ["×”×’×“×¨×•×ª", "×’×™×‘×•×™/××™×¤×•×¡ ×•×—×™×‘×•×¨ ×œ-Google Sheets"]
  };
  el("viewTitle").textContent = titles[view][0];
  el("viewSub").textContent = titles[view][1];

  renderAll();
}

/* ===== Modal ===== */
function openModal(title, html){
  el("modalTitle").textContent = title;
  el("modalBody").innerHTML = html;
  el("modalBack").style.display = "flex";
}
function closeModal(){
  el("modalBack").style.display = "none";
  el("modalBody").innerHTML = "";
}
el("modalClose").addEventListener("click", closeModal);
el("modalBack").addEventListener("click", (e)=>{
  if(e.target === el("modalBack")) closeModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key==="Escape") closeModal();
  if(e.key==="/" && document.activeElement?.tagName !== "INPUT" && document.activeElement?.tagName !== "TEXTAREA"){
    e.preventDefault();
    el("q").focus();
  }
  if((e.key==="n" || e.key==="N") && !el("modalBack").style.display.includes("flex")){
    openLeadForm();
  }
});

/* ===== Toast ===== */
let toastTimer=null;
function toast(msg){
  const t = el("toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.style.display="none", 2600);
}

/* ===== Filters/Search/Sort ===== */
el("q").addEventListener("input", renderLeads);
el("fStatus").addEventListener("change", renderLeads);
el("fSource").addEventListener("change", renderLeads);
el("sortBy").addEventListener("change", renderLeads);

/* ===== Buttons ===== */
el("btnAddLead").addEventListener("click", openLeadForm);
el("btnQuickTask").addEventListener("click", ()=> openTaskForm());
el("btnOpenInsights").addEventListener("click", ()=> openInsights());
el("btnSeed").addEventListener("click", seedSample);
el("btnExport").addEventListener("click", exportJSON);
el("btnImport").addEventListener("click", importJSON);
el("btnBackup").addEventListener("click", exportJSON);
el("btnReset").addEventListener("click", ()=>{
  if(confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×? ×¤×¢×•×œ×” ×‘×œ×ª×™ ×”×¤×™×›×”.")){
    localStorage.removeItem(LS_KEY);
    location.reload();
  }
});

function exportJSON(){
  const blob = new Blob([JSON.stringify(appState, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "leadup-backup.json";
  a.click();
  URL.revokeObjectURL(url);
  toast("×’×™×‘×•×™ ×™×¨×“ ×œ××—×©×‘ âœ…");
}
function importJSON(){
  const inp = document.createElement("input");
  inp.type = "file";
  inp.accept = "application/json";
  inp.onchange = () => {
    const f = inp.files?.[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const parsed = JSON.parse(reader.result);
        if(!parsed || typeof parsed !== "object") throw new Error("bad");
        appState.user = parsed.user || appState.user;
        appState.leads = Array.isArray(parsed.leads) ? parsed.leads : appState.leads;
        appState.tasks = Array.isArray(parsed.tasks) ? parsed.tasks : appState.tasks;
        appState.events = Array.isArray(parsed.events) ? parsed.events : appState.events;
        addEvent("import", "×™×™×‘×•× × ×ª×•× ×™× ×‘×•×¦×¢");
        saveState();
        toast("×™×™×‘×•× ×”×¦×œ×™×— âœ…");
      }catch(e){
        alert("×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ");
      }
    };
    reader.readAsText(f);
  };
  inp.click();
}

/* ===== Leads CRUD ===== */
function openLeadForm(leadId=null){
  const lead = leadId ? appState.leads.find(l=>l.id===leadId) : null;
  const isEdit = !!lead;
  const data = lead || {
    id: uid("lead"),
    name:"",
    phone:"",
    email:"",
    status:"×—×“×©",
    source:"××—×¨",
    owner:"×× ×”×œ",
    note:"",
    createdAt: nowISO(),
    lastContactAt:"",
    nextFollowUpAt:"",
    contactCount: 0
  };

  openModal(isEdit ? "×¢×¨×™×›×ª ×œ×™×“" : "×œ×™×“ ×—×“×©", `
    <div class="split">
      <div>
        <form id="leadForm">
          <div class="row">
            <div>
              <label>×©× ××œ×</label>
              <input name="name" value="${escapeHTML(data.name)}" placeholder="×œ×“×•×’××”: ×™×©×¨××œ ×™×©×¨××œ×™" required/>
            </div>
            <div>
              <label>×˜×œ×¤×•×Ÿ</label>
              <input name="phone" value="${escapeHTML(data.phone)}" placeholder="05X-XXXXXXX" inputmode="tel"/>
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>××™××™×™×œ</label>
              <input name="email" value="${escapeHTML(data.email)}" placeholder="name@email.com" inputmode="email"/>
            </div>
            <div>
              <label>×‘×¢×œ×™× (× ×¦×™×’)</label>
              <input name="owner" value="${escapeHTML(data.owner||"×× ×”×œ")}" placeholder="×©× × ×¦×™×’"/>
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>×¡×˜×˜×•×¡</label>
              <select name="status">
                ${["×—×“×©","× ×•×¦×¨ ×§×©×¨","××ª×¢× ×™×™×Ÿ","×”×¦×¢×ª ××—×™×¨","× ×¡×’×¨","×œ× ×¨×œ×•×•× ×˜×™"].map(s=>`
                  <option ${s===data.status?"selected":""}>${s}</option>
                `).join("")}
              </select>
            </div>
            <div>
              <label>××§×•×¨</label>
              <select name="source">
                ${["×¤×™×™×¡×‘×•×§","×’×•×’×œ","×”×¤× ×™×”","×˜×œ×¤×•×Ÿ","××ª×¨","××—×¨"].map(s=>`
                  <option ${s===data.source?"selected":""}>${s}</option>
                `).join("")}
              </select>
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>××¢×§×‘ ×”×‘× (×ª××¨×™×š/×©×¢×”)</label>
              <input name="nextFollowUpAt" value="${escapeHTML(toLocalDT(data.nextFollowUpAt))}" type="datetime-local"/>
            </div>
            <div>
              <label>×¢×“×›×•×Ÿ "×“×™×‘×¨× ×•" (××¢×œ×” score)</label>
              <button type="button" class="btn" id="btnTouch" style="width:100%">â˜ï¸ ×¡×™××•×Ÿ ×©×™×—×”/××¢× ×”</button>
              <div class="help">××¢×œ×” Contact Count + ××¢×“×›×Ÿ Last Contact.</div>
            </div>
          </div>

          <div style="margin-top:10px">
            <label>×”×¢×¨×”</label>
            <textarea name="note" placeholder="×¨×©×•× ×¤×¨×˜×™× ×—×©×•×‘×™×â€¦">${escapeHTML(data.note||"")}</textarea>
          </div>

          <div class="sep"></div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start">
            <button class="btn gold" type="submit">ğŸ’¾ ×©××™×¨×”</button>
            <button class="btn" type="button" id="btnCreateTask">â° ×¦×•×¨ ××©×™××” ×œ×œ×™×“</button>
            ${isEdit ? `<button class="btn danger" type="button" id="btnDeleteLead">ğŸ—‘ï¸ ××—×™×§×”</button>` : ""}
            <button class="btn" type="button" id="btnOpenContact">ğŸ“² ×¤×¢×•×œ×•×ª ×§×©×¨</button>
          </div>

          <div class="help">
            Lead Score ××ª×—×©×‘ ×‘×¡×˜×˜×•×¡, ××§×•×¨, ×›××•×ª ×©×™×—×•×ª ×•×–××Ÿ ×©×¢×‘×¨.
          </div>
        </form>
      </div>

      <div>
        <div class="miniCard">
          <h3>×ª×¦×•×’×” ××”×™×¨×”</h3>
          <div class="small muted">× ×•×¦×¨: ${fmtDT(data.createdAt)}</div>
          <div class="small muted">×©×™×—×” ××—×¨×•× ×”: ${data.lastContactAt ? fmtDT(data.lastContactAt) : "â€”"}</div>
          <div class="small muted">×©×™×—×•×ª/××¢× ×™×: ${Number(data.contactCount||0)}</div>
          <div class="sep"></div>
          <div class="score">
            <div class="tag ${heatTag(computeScore(data)).cls}">ğŸ”¥ ${heatTag(computeScore(data)).label}</div>
            <div style="font-weight:800">${computeScore(data)}/100</div>
          </div>
          <div class="bar" style="margin-top:10px"><i style="width:${computeScore(data)}%"></i></div>
          <div class="help">×›×›×œ ×©×”×¦×™×•×Ÿ ×’×‘×•×” ×™×•×ª×¨â€”×”×œ×™×“ â€œ×—×â€ ×™×•×ª×¨.</div>
        </div>

        <div class="miniCard" style="margin-top:10px">
          <h3>×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h3>
          <div class="actions">
            <button type="button" class="iconBtn gold" title="×•×•××˜×¡××¤" id="qaWA">ğŸ’¬</button>
            <button type="button" class="iconBtn" title="×”×ª×§×©×¨" id="qaCall">ğŸ“</button>
            <button type="button" class="iconBtn" title="××™××™×™×œ" id="qaMail">âœ‰ï¸</button>
            <button type="button" class="iconBtn" title="×”×¢×ª×§ ×˜×œ×¤×•×Ÿ" id="qaCopy">ğŸ“‹</button>
          </div>
          <div class="help">×‘×’×œ×œ ×©×‘×™×§×©×ª â€œ×œ×œ× ×—×œ×•×Ÿ ×—×™×¦×•× ×™â€ â€” ×›××Ÿ ××•×¦×’ ×˜×§×¡×˜/×§×™×©×•×¨ ×œ×”×¢×ª×§×” ×‘×ª×•×š ×”××•×“××œ.</div>
        </div>
      </div>
    </div>
  `);

  // form handlers
  const form = document.getElementById("leadForm");
  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    const fd = new FormData(form);
    const updated = { ...data };
    for(const [k,v] of fd.entries()){
      updated[k] = v;
    }
    updated.nextFollowUpAt = fromLocalDT(updated.nextFollowUpAt);
    // keep createdAt
    updated.createdAt = data.createdAt || nowISO();

    const idx = appState.leads.findIndex(l=>l.id===updated.id);
    if(idx>=0){
      appState.leads[idx] = updated;
      addEvent("lead_update", `×¢×•×“×›×Ÿ ×œ×™×“: ${updated.name}`, {leadId: updated.id});
      toast("×œ×™×“ ×¢×•×“×›×Ÿ âœ…");
    }else{
      appState.leads.unshift(updated);
      addEvent("lead_create", `× ×•×¦×¨ ×œ×™×“ ×—×“×©: ${updated.name}`, {leadId: updated.id});
      toast("×œ×™×“ × ×•×¡×£ âœ…");
    }
    saveState();
    closeModal();
  });

  // Touch (log contact)
  document.getElementById("btnTouch").addEventListener("click", ()=>{
    data.contactCount = Number(data.contactCount||0) + 1;
    data.lastContactAt = nowISO();
    addEvent("contact", `×©×™×—×”/××¢× ×” ×¡×•××Ÿ ×œ×œ×™×“: ${data.name||"(×œ×œ× ×©×)"}`, {leadId:data.id});
    toast("×¡×•××Ÿ ×©×™×—×” âœ… (××œ ×ª×©×›×— ×œ×©××•×¨)");
    // re-open to refresh score visuals
    openLeadForm(data.id ? data.id : null);
  });

  // delete
  if(isEdit){
    document.getElementById("btnDeleteLead").addEventListener("click", ()=>{
      if(!confirm("×œ××—×•×§ ××ª ×”×œ×™×“?")) return;
      appState.leads = appState.leads.filter(l=>l.id!==leadId);
      appState.tasks = appState.tasks.filter(t=>t.leadId!==leadId);
      addEvent("lead_delete", `× ××—×§ ×œ×™×“: ${lead.name}`, {leadId});
      saveState();
      closeModal();
      toast("×œ×™×“ × ××—×§ ğŸ—‘ï¸");
    });
  }

  // create task for lead
  document.getElementById("btnCreateTask").addEventListener("click", ()=>{
    openTaskForm({ leadId: data.id, leadName: data.name, presetDate: data.nextFollowUpAt });
  });

  // contact actions in-modal
  document.getElementById("btnOpenContact").addEventListener("click", ()=>{
    openContactPanel(data);
  });
  document.getElementById("qaWA").addEventListener("click", ()=> openContactPanel(data, "wa"));
  document.getElementById("qaCall").addEventListener("click", ()=> openContactPanel(data, "call"));
  document.getElementById("qaMail").addEventListener("click", ()=> openContactPanel(data, "mail"));
  document.getElementById("qaCopy").addEventListener("click", ()=>{
    navigator.clipboard?.writeText(data.phone||"");
    toast("×”×˜×œ×¤×•×Ÿ ×”×•×¢×ª×§ ğŸ“‹");
  });
}

function openContactPanel(lead, focus="wa"){
  const phoneDigits = (lead.phone||"").replace(/[^\d]/g,"");
  const waLink = phoneDigits ? `https://wa.me/972${phoneDigits.replace(/^0/,"")}` : "";
  const callLink = phoneDigits ? `tel:${phoneDigits}` : "";
  const mailLink = (lead.email||"
